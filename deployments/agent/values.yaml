# Default values for session-manager-agent.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# +docs:section=Global

# Global settings are used to share the values among LLMariner components.
# session-manager-agent is a dependency of LLMariner, so global values are
# propagated at its installation.
# Please see https://github.com/llmariner/llmariner/blob/main/deployments/llmariner.
global:
  # Specify the worker configuration to access the control-plane.
  worker:
    # Configuration of the Secret used for worker authentication when
    # communication with the control plane.
    registrationKeySecret:
      # The secret name. `default-cluster-registration-key` is available
      # when the control-plane and worker-plane are in the same cluster.
      # This Secret is generated by cluster-manager-server as default.
      # For more information, see [Install across Multiple Clusters](https://llmariner.ai/docs/setup/install/multi_cluster_production/).
      name: default-cluster-registration-key
      # The key name with a registration key set.
      key: key

    tls:
      # The flag to enable TLS access to the control-plane.
      enable: false

    # If specified, use this address for accessing the control-plane.
    # This is necessary when installing LLMariner in a multi-cluster mode.
    # For more information, see [Install across Multiple Clusters](https://llmariner.ai/docs/setup/install/multi_cluster_production/).
    controlPlaneAddr: ""

# +docs:section=Agent

# The HTTP port number.
# +docs:type=number
httpPort: 8080

# The ID of this cluster.
envoyClusterId: local-cluster-id

# This default value works if session-manager-server runs in the same namespace.
sessionManagerServerWorkerServiceAddr: session-manager-server-worker-service-http:8082

componentStatusSender:
  # The flag to enable the component status sender.
  enable : true
  # The name of the component.
  name: session-manager-agent
  # initialDelay is the time to wait before starting the sender.
  initialDelay: 1m
  # The interval time to send the component status.
  interval: 15m
  # The address of the cluster-manager-server to call worker services.
  clusterManagerServerWorkerServiceAddr: cluster-manager-server-worker-service-grpc:8082

proxy:
  # Deprecated. Use sessionManagerServerWorkerServiceAddr instead.
  # +docs:hidden
  baseUrl: ""

  http:
    # pool size of the HTTP tunnel
    # Currently server supports only one channel per agent.
    # +docs:type=number
    poolSize: 1

  upgrade:
    # pool size of the HTTP upgrade tunnel
    # +docs:type=number
    poolSize: 10

  slurm:
    # Enable request routing to Slurm control plane.
    enable: false
    # The address of the REST endpoint of Slurm control plane.
    controlPlaneAddress: ""
    # The port number of the REST endpoint of Slurm control plane.
    # +docs:type=number
    controlPlanePort: 6820

# If enabled, show the debugging logs of the session-manager-agent.
debugLogging: true

# Override the "session-manager-agent.fullname" value. This value is used
# as part of most of the names of the resources created by this Helm chart.
# +docs:property
# fullnameOverride: "my-session-manager-agent"

# Override the "session-manager-agent.name" value, which is used to annotate
# some of the resources that are created by this Chart (using "app.kubernetes.io/name").
# +docs:property
# nameOverride: "my-session-manager-agent"

serviceAccount:
  # Specifies whether a service account should be created.
  create: true

  # The name of the service account to use. If not set and create is
  # true, a name is generated using the fullname template.
  # +docs:property
  # name: ""

# The number of replicas for the session-manager-agent Deployment.
# +docs:type=number
replicaCount: 1

# The container image of session-manager-agent.
image:
  # The container image name.
  repository: public.ecr.aws/cloudnatix/llmariner/session-manager-agent
  # Kubernetes imagePullPolicy on Deployment.
  pullPolicy: IfNotPresent

# Override the container image tag to deploy by setting this variable.
# If no value is set, the chart's appVersion will be used.
# +docs:property
# version: vX.Y.Z

# Optional additional annotations to add to the Deployment Pods.
# +docs:property
# podAnnotations: {}

# The nodeSelector on Pods tells Kubernetes to schedule Pods on the
# nodes with matching labels.
# For more information, see [Assigning Pods to Nodes](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
# +docs:property
# nodeSelector: {}

# A Kubernetes Affinity, if required.
# For more information, see [Assigning Pods to Nodes](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node).
#
# For example:
#   affinity:
#     nodeAffinity:
#      requiredDuringSchedulingIgnoredDuringExecution:
#        nodeSelectorTerms:
#        - matchExpressions:
#          - key: foo.bar.com/role
#            operator: In
#            values:
#            - master
#
# +docs:property
# affinity: {}

# A list of Kubernetes Tolerations, if required.
# For more information, see [Taints and Tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/).
#
# For example:
#   tolerations:
#   - key: foo.bar.com/role
#     operator: Equal
#     value: master
#     effect: NoSchedule
#
# +docs:property
# tolerations: []

# Resources to provide to the session-manager-agent pod.
# For more information, see [Resource Management for Pods and Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-Containers/).
#
# For example:
#  requests:
#    cpu: 10m
#    memory: 32Mi
#
# +docs:property
resources:
  requests:
    cpu: "250m"
    memory: "500Mi"
  limits:
    cpu: "250m"

# ReadinessProbe settings for the session-manager-agent pod.
# For more information, see [Liveness, Readiness, and Startup Probes](https://kubernetes.io/docs/concepts/configuration/liveness-readiness-startup-probes/)
readinessProbe:
  # Number of seconds after the container has started before startup,
  # liveness or readiness probes are initiated.
  # +docs:type=number
  initialDelaySeconds: 5
  # How often (in seconds) to perform the probe.
  # +docs:type=number
  periodSeconds: 60
  # Number of seconds after which the probe times out.
  # +docs:type=number
  timeoutSeconds: 5
  # Minimum consecutive successes for the probe to be considered
  # successful after having failed.
  # +docs:type=number
  successThreshold: 1
  # After a probe fails `failureThreshold` times in a row, Kubernetes
  # considers that the overall check has failed: the container is not
  # ready/healthy/live.
  # +docs:type=number
  failureThreshold: 3

# Additional volumes to add to the session-manager-server pod.
# For more information, see [Volumes](https://kubernetes.io/docs/concepts/storage/volumes/).
# +docs:property
# volumes: []

# Additional volume mounts to add to the session-manager-server container.
# For more information, see [Volumes](https://kubernetes.io/docs/concepts/storage/volumes/).
# +docs:property
# volumeMounts: []

# This field can be used as a condition when using it as a dependency.
# This definition is only here as a placeholder such that it is
# included in the json schema.
# +docs:hidden
# +docs:property
# enable: true
